@if (summary()) {
<span
  [title]="_getFormatterTooltip(data() | cellSummary: colDef())"
  [innerHTML]="_getText(data() | cellSummary: colDef())"
>
</span>
} @else {
<!-- Custom formatting -->
@if (colDef().formatter) {
<span
  [title]="_getFormatterTooltip(colDef().formatter(rowData(), colDef()))"
  [innerHTML]="_getText(colDef().formatter(rowData(), colDef()))"
>
</span>
} @else {
<!-- Default formatting -->
@switch (colDef().type) {
<!-- Buttons -->
@case ('button') { @for ( btn of colDef().buttons | cellActions: rowData() : rowChangeRecord :
rowChangeRecord?.currentValue; track btn ) { @if (!btn.iif || btn.iif(rowData())) { @if
(btn.children && btn.children.length > 0) { @if (btn.type === 'icon') {
<button
  matIconButton
  [color]="btn.color || 'primary'"
  type="button"
  class="acp-grid-action-button"
  [class]="btn.class"
  [disabled]="
                    btn
                      | cellActionDisable
                        : rowData()
                        : rowChangeRecord
                        : rowChangeRecord?.currentValue
                  "
  [matTooltip]="(btn | cellActionTooltip).message | toObservable | async"
  [matTooltipClass]="(btn | cellActionTooltip).class"
  [matTooltipHideDelay]="(btn | cellActionTooltip).hideDelay"
  [matTooltipShowDelay]="(btn | cellActionTooltip).showDelay"
  [matTooltipPosition]="(btn | cellActionTooltip).position || 'below'"
  [matTooltipPositionAtOrigin]="(btn | cellActionTooltip).positionAtOrigin"
  [matTooltipTouchGestures]="(btn | cellActionTooltip).touchGestures || 'auto'"
  [matTooltipDisabled]="(btn | cellActionTooltip).disabled"
  [matBadge]="(btn | cellActionBadge).content | toObservable | async"
  [matBadgeDescription]="(btn | cellActionBadge).description | toObservable | async"
  [matBadgeColor]="(btn | cellActionBadge).color"
  [matBadgePosition]="(btn | cellActionBadge).position || 'above after'"
  [matBadgeSize]="(btn | cellActionBadge).size || 'medium'"
  [matBadgeOverlap]="(btn | cellActionBadge).overlap"
  [matBadgeDisabled]="(btn | cellActionBadge).disabled"
  [matBadgeHidden]="(btn | cellActionBadge).hidden"
  [matMenuTriggerFor]="
                    btn.children && btn.children.length > 0 ? gridMenu.menu : null
                  "
  (click)="$event.stopPropagation()"
>
  <mat-icon *ngTemplateOutlet="iconTpl; context: { $implicit: btn }" />
</button>

<acp-data-grid-menu #gridMenu [items]="btn.children || []" [data]="rowData()" />
} @else {
<button
  [matButton]="btn.type || 'text'"
  [color]="btn.color || 'primary'"
  type="button"
  class="acp-grid-action-button"
  [class]="btn.class"
  [disabled]="
                    btn
                      | cellActionDisable
                        : rowData()
                        : rowChangeRecord
                        : rowChangeRecord?.currentValue
                  "
  [matTooltip]="(btn | cellActionTooltip).message | toObservable | async"
  [matTooltipClass]="(btn | cellActionTooltip).class"
  [matTooltipHideDelay]="(btn | cellActionTooltip).hideDelay"
  [matTooltipShowDelay]="(btn | cellActionTooltip).showDelay"
  [matTooltipPosition]="(btn | cellActionTooltip).position || 'below'"
  [matTooltipPositionAtOrigin]="(btn | cellActionTooltip).positionAtOrigin"
  [matTooltipTouchGestures]="(btn | cellActionTooltip).touchGestures || 'auto'"
  [matTooltipDisabled]="(btn | cellActionTooltip).disabled"
  [matBadge]="(btn | cellActionBadge).content | toObservable | async"
  [matBadgeDescription]="(btn | cellActionBadge).description | toObservable | async"
  [matBadgeColor]="(btn | cellActionBadge).color"
  [matBadgePosition]="(btn | cellActionBadge).position || 'above after'"
  [matBadgeSize]="(btn | cellActionBadge).size || 'medium'"
  [matBadgeOverlap]="(btn | cellActionBadge).overlap"
  [matBadgeDisabled]="(btn | cellActionBadge).disabled"
  [matBadgeHidden]="(btn | cellActionBadge).hidden"
  [matMenuTriggerFor]="
                    btn.children && btn.children.length > 0 ? gridMenu.menu : null
                  "
  (click)="$event.stopPropagation()"
>
  <mat-icon *ngTemplateOutlet="iconTpl; context: { $implicit: btn }" />
  <span>{{ btn.text | toObservable | async }}</span>
</button>

<acp-data-grid-menu #gridMenu [items]="btn.children || []" [data]="rowData()" />
} } @else { @if (btn.type === 'icon') {
<button
  matIconButton
  [color]="btn.color || 'primary'"
  type="button"
  class="acp-grid-action-button"
  [class]="btn.class"
  [disabled]="
                    btn
                      | cellActionDisable
                        : rowData()
                        : rowChangeRecord
                        : rowChangeRecord?.currentValue
                  "
  [matTooltip]="(btn | cellActionTooltip).message | toObservable | async"
  [matTooltipClass]="(btn | cellActionTooltip).class"
  [matTooltipHideDelay]="(btn | cellActionTooltip).hideDelay"
  [matTooltipShowDelay]="(btn | cellActionTooltip).showDelay"
  [matTooltipPosition]="(btn | cellActionTooltip).position || 'below'"
  [matTooltipPositionAtOrigin]="(btn | cellActionTooltip).positionAtOrigin"
  [matTooltipTouchGestures]="(btn | cellActionTooltip).touchGestures || 'auto'"
  [matTooltipDisabled]="(btn | cellActionTooltip).disabled"
  [matBadge]="(btn | cellActionBadge).content | toObservable | async"
  [matBadgeDescription]="(btn | cellActionBadge).description | toObservable | async"
  [matBadgeColor]="(btn | cellActionBadge).color"
  [matBadgePosition]="(btn | cellActionBadge).position || 'above after'"
  [matBadgeSize]="(btn | cellActionBadge).size || 'medium'"
  [matBadgeOverlap]="(btn | cellActionBadge).overlap"
  [matBadgeDisabled]="(btn | cellActionBadge).disabled"
  [matBadgeHidden]="(btn | cellActionBadge).hidden"
  (click)="_onActionClick($event, btn, rowData())"
>
  <mat-icon *ngTemplateOutlet="iconTpl; context: { $implicit: btn }" />
</button>
} @else {
<button
  [matButton]="btn.type || 'text'"
  [color]="btn.color || 'primary'"
  type="button"
  class="acp-grid-action-button"
  [class]="btn.class"
  [disabled]="
                    btn
                      | cellActionDisable
                        : rowData()
                        : rowChangeRecord
                        : rowChangeRecord?.currentValue
                  "
  [matTooltip]="(btn | cellActionTooltip).message | toObservable | async"
  [matTooltipClass]="(btn | cellActionTooltip).class"
  [matTooltipHideDelay]="(btn | cellActionTooltip).hideDelay"
  [matTooltipShowDelay]="(btn | cellActionTooltip).showDelay"
  [matTooltipPosition]="(btn | cellActionTooltip).position || 'below'"
  [matTooltipPositionAtOrigin]="(btn | cellActionTooltip).positionAtOrigin"
  [matTooltipTouchGestures]="(btn | cellActionTooltip).touchGestures || 'auto'"
  [matTooltipDisabled]="(btn | cellActionTooltip).disabled"
  [matBadge]="(btn | cellActionBadge).content | toObservable | async"
  [matBadgeDescription]="(btn | cellActionBadge).description | toObservable | async"
  [matBadgeColor]="(btn | cellActionBadge).color"
  [matBadgePosition]="(btn | cellActionBadge).position || 'above after'"
  [matBadgeSize]="(btn | cellActionBadge).size || 'medium'"
  [matBadgeOverlap]="(btn | cellActionBadge).overlap"
  [matBadgeDisabled]="(btn | cellActionBadge).disabled"
  [matBadgeHidden]="(btn | cellActionBadge).hidden"
  (click)="_onActionClick($event, btn, rowData())"
>
  <mat-icon *ngTemplateOutlet="iconTpl; context: { $implicit: btn }" />
  <span>{{ btn.text | toObservable | async }}</span>
</button>
} } } } }
<!-- Tag -->
@case ('tag') { @if (colDef().tag && colDef().tag[_value]) {
<mat-chip-listbox>
  <mat-chip color="primary" [class]="'bg-' + colDef().tag[_value].color">
    {{ colDef().tag[_value].text }}
  </mat-chip>
</mat-chip-listbox>
} @else { {{ _value }} } }
<!-- Link -->
@case ('link') {
<a [href]="_value" target="_blank">{{ _value }}</a>
}
<!-- Image -->
@case ('image') { @if (_value) {
<!-- Imagen real -->
<img class="placeholder-image" [src]="_value" alt="img" />
} @else {
<!-- Placeholder -->
<div class="placeholder-box">
  <svg class="placeholder-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M4 16l4.586-4.586a2 2 0 012.828 0L15 14m-12 5h16a1 1 0 001-1V5a1 1 0 00-1-1H3a1 1 0 00-1 1v14a1 1 0 001 1z"
    />
  </svg>
</div>
} }
<!-- Boolean -->
@case ('boolean') {
<span [title]="_getTooltip(_value)">{{ _getText(_value) }}</span>
}
<!-- Number -->
@case ('number') {
<span
  [title]="
            _getTooltip(
              _value | number: colDef().typeParameter?.digitsInfo : colDef().typeParameter?.locale
            )
          "
>
  {{ _getText( _value | number: colDef().typeParameter?.digitsInfo : colDef().typeParameter?.locale
  ) }}
</span>
}
<!-- Currency -->
@case ('currency') {
<span
  [title]="
            _getTooltip(
              _value
                | currency
                  : colDef().typeParameter?.currencyCode
                  : colDef().typeParameter?.display
                  : colDef().typeParameter?.digitsInfo
                  : colDef().typeParameter?.locale
            )
          "
>
  {{ _getText( _value | currency : colDef().typeParameter?.currencyCode :
  colDef().typeParameter?.display : colDef().typeParameter?.digitsInfo :
  colDef().typeParameter?.locale ) }}
</span>
}
<!-- Percent -->
@case ('percent') {
<span
  [title]="
            _getTooltip(
              _value | percent: colDef().typeParameter?.digitsInfo : colDef().typeParameter?.locale
            )
          "
>
  {{ _getText( _value | percent: colDef().typeParameter?.digitsInfo : colDef().typeParameter?.locale
  ) }}
</span>
}
<!-- Date -->
@case ('date') {
<span
  [title]="
            _getTooltip(
              _value
                | date
                  : colDef().typeParameter?.format
                  : colDef().typeParameter?.timezone
                  : colDef().typeParameter?.locale
            )
          "
>
  {{ _getText( _value | date : colDef().typeParameter?.format : colDef().typeParameter?.timezone :
  colDef().typeParameter?.locale ) }}
</span>
}
<!-- Default -->
@default {
<span [title]="_getTooltip(_value)">{{ _getText(_value) }}</span>
} } } }

<ng-template #iconTpl let-btn>
  @if (btn.icon) {
  <mat-icon class="acp-grid-icon">{{ btn.icon }}</mat-icon>
  } @else if (btn.fontIcon) {
  <mat-icon class="acp-grid-icon" [fontIcon]="btn.fontIcon" />
  } @else if (btn.svgIcon) {
  <mat-icon class="acp-grid-icon" [svgIcon]="btn.svgIcon" />
  }
</ng-template>
