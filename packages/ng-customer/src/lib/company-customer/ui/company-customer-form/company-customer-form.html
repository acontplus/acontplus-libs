<div class="customer-form-container">
  <h2>{{ mode === 'create' ? 'Nuevo Cliente' : 'Editar Cliente' }}</h2>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="customer-form">
    @if (errorMessage) {
    <div class="alert alert-error">{{ errorMessage }}</div>
    }

    <!-- idCard -->
    @if (isFieldVisible('idCard')) {
    <mat-form-field appearance="outline">
      <mat-label>{{ getFieldLabel('idCard') }}</mat-label>

      <input
        matInput
        type="text"
        formControlName="idCard"
        [placeholder]="getFieldPlaceholder('idCard')"
      />

      @if (form.get('idCard')?.invalid && form.get('idCard')?.touched) {
      <mat-error>{{ getErrorMessage('idCard') }}</mat-error>
      }
    </mat-form-field>
    }

    <!-- name -->
    @if (isFieldVisible('name')) {
    <mat-form-field appearance="outline">
      <mat-label>{{ getFieldLabel('name') }}</mat-label>

      <input
        matInput
        type="text"
        formControlName="name"
        [placeholder]="getFieldPlaceholder('name')"
      />

      @if (form.get('name')?.invalid && form.get('name')?.touched) {
      <mat-error>{{ getErrorMessage('name') }}</mat-error>
      }
    </mat-form-field>
    }

    <!-- lastName -->
    @if (isFieldVisible('lastName')) {
    <mat-form-field appearance="outline">
      <mat-label>{{ getFieldLabel('lastName') }}</mat-label>

      <input
        matInput
        type="text"
        formControlName="lastName"
        [placeholder]="getFieldPlaceholder('lastName')"
      />

      @if (form.get('lastName')?.invalid && form.get('lastName')?.touched) {
      <mat-error>{{ getErrorMessage('lastName') }}</mat-error>
      }
    </mat-form-field>
    }

    <!-- email -->
    @if (isFieldVisible('email')) {
    <mat-form-field appearance="outline">
      <mat-label>{{ getFieldLabel('email') }}</mat-label>

      <input
        matInput
        type="email"
        formControlName="email"
        [placeholder]="getFieldPlaceholder('email')"
      />

      @if (form.get('email')?.invalid && form.get('email')?.touched) {
      <mat-error>{{ getErrorMessage('email') }}</mat-error>
      }
    </mat-form-field>
    }

    <!-- phone -->
    @if (isFieldVisible('phone')) {
    <mat-form-field appearance="outline">
      <mat-label>{{ getFieldLabel('phone') }}</mat-label>

      <input
        matInput
        type="tel"
        formControlName="phone"
        [placeholder]="getFieldPlaceholder('phone')"
      />

      @if (form.get('phone')?.invalid && form.get('phone')?.touched) {
      <mat-error>{{ getErrorMessage('phone') }}</mat-error>
      }
    </mat-form-field>
    }

    <!-- address -->
    @if (isFieldVisible('address')) {
    <mat-form-field appearance="outline">
      <mat-label>{{ getFieldLabel('address') }}</mat-label>

      <input
        matInput
        type="text"
        formControlName="address"
        [placeholder]="getFieldPlaceholder('address')"
      />

      @if (form.get('address')?.invalid && form.get('address')?.touched) {
      <mat-error>{{ getErrorMessage('address') }}</mat-error>
      }
    </mat-form-field>
    }

    <!-- city -->
    @if (isFieldVisible('city')) {
    <mat-form-field appearance="outline">
      <mat-label>{{ getFieldLabel('city') }}</mat-label>

      <input
        matInput
        type="text"
        formControlName="city"
        [placeholder]="getFieldPlaceholder('city')"
      />

      @if (form.get('city')?.invalid && form.get('city')?.touched) {
      <mat-error>{{ getErrorMessage('city') }}</mat-error>
      }
    </mat-form-field>
    }

    <!-- dateOfBirth -->
    @if (isFieldVisible('dateOfBirth')) {
    <mat-form-field appearance="outline">
      <mat-label>{{ getFieldLabel('dateOfBirth') }}</mat-label>

      <input matInput type="date" formControlName="dateOfBirth" />

      @if (form.get('dateOfBirth')?.invalid && form.get('dateOfBirth')?.touched) {
      <mat-error>{{ getErrorMessage('dateOfBirth') }}</mat-error>
      }
    </mat-form-field>
    }

    <!-- notes -->
    @if (isFieldVisible('notes')) {
    <mat-form-field appearance="outline">
      <mat-label>{{ getFieldLabel('notes') }}</mat-label>

      <textarea
        matInput
        formControlName="notes"
        [placeholder]="getFieldPlaceholder('notes')"
        rows="3"
      ></textarea>

      @if (form.get('notes')?.invalid && form.get('notes')?.touched) {
      <mat-error>{{ getErrorMessage('notes') }}</mat-error>
      }
    </mat-form-field>
    }

    <!-- Buttons -->
    <div class="form-actions">
      <button type="button" class="btn btn-secondary" (click)="onCancel()" [disabled]="isLoading()">
        {{ config.cancelButtonText }}
      </button>

      <button type="submit" class="btn btn-primary" [disabled]="isLoading() || form.invalid">
        @if (!isLoading()) {
        <span>{{ config.submitButtonText }}</span>
        } @else {
        <span>Guardando...</span>
        }
      </button>
    </div>
  </form>
</div>
